import{r as d,a as y,j as e,H as W}from"./app-B-XTbUoe.js";import{A as z}from"./app-layout-DsHkyj2r.js";import{D as G,a as J,b as K,c as Q,d as X,e as Z}from"./dialog-tgs6LFuy.js";/* empty css            */import"./app-logo-icon-DUzGgLPl.js";import"./index-BKf4NpSc.js";import"./index-D61l1uVg.js";import"./index-CiEIW7uy.js";const ee=[{title:"Purchase history",href:"/purchase-history"}],re=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function ce(){const[c,Y]=d.useState([]),[l,u]=d.useState(!0),[N,v]=d.useState(null),[i,p]=d.useState(1),[h,q]=d.useState(1),[k,L]=d.useState(0),[x,I]=d.useState({from:null,to:null}),[s,n]=d.useState({status:"",reference:"",from:"",to:"",min_total:"",max_total:""}),[w,U]=d.useState(new Set),[g,S]=d.useState("history"),[m,b]=d.useState(null),[C,P]=d.useState(5),[f,D]=d.useState(""),[_,j]=d.useState(null),[R,E]=d.useState(!1),[M,H]=d.useState(null),$=d.useMemo(()=>{const r=new URLSearchParams;return s.status&&r.set("status",s.status),s.reference&&r.set("reference",s.reference),s.from&&r.set("from",s.from),s.to&&r.set("to",s.to),s.min_total&&r.set("min_total",s.min_total),s.max_total&&r.set("max_total",s.max_total),r.set("page",String(i)),r.set("per_page","10"),r},[i,s]);d.useEffect(()=>{p(1)},[s]),d.useEffect(()=>{const r=new AbortController;return u(!0),v(null),y.get("/api/purchases",{signal:r.signal,params:Object.fromEntries($.entries())}).then(t=>{const a=t.data.purchases;Y(a.data),q(a.last_page),L(a.total),I({from:a.from,to:a.to}),u(!1)}).catch(t=>{y.isCancel(t)||(console.error("Error fetching purchases:",t),v("Unable to load purchase history right now."),u(!1))}),()=>r.abort()},[$]);const o=r=>re.format(r),A=r=>{const t=new URLSearchParams;s.status&&t.set("status",s.status),s.reference&&t.set("reference",s.reference),s.from&&t.set("from",s.from),s.to&&t.set("to",s.to),s.min_total&&t.set("min_total",s.min_total),s.max_total&&t.set("max_total",s.max_total);const a=`/api/purchases/export/${r}?${t.toString()}`;if(r==="print"){window.open(a,"_blank","noopener,noreferrer");return}window.location.href=a},V=r=>{U(t=>{const a=new Set(t);return a.has(r)?a.delete(r):a.add(r),a})},F=d.useMemo(()=>{const r=new Map;return c.forEach(t=>{t.items?.forEach(a=>{if(!a.product_id)return;const T=r.get(a.product_id);T?T.quantity+=a.quantity:r.set(a.product_id,{productId:a.product_id,name:a.name,quantity:a.quantity})})}),Array.from(r.values())},[c]),O=(r,t)=>{b({productId:r,name:t}),P(5),D(""),j(null)},B=async()=>{if(m){E(!0),j(null);try{const r=await y.post(`/api/products/${m.productId}/reviews`,{rating:C,comment:f});H(r.data.message??"Review submitted."),b(null)}catch(r){console.error("Review submit failed:",r),j(r?.response?.data?.message??"Unable to submit your review right now.")}finally{E(!1)}}};return e.jsxs(z,{breadcrumbs:ee,children:[e.jsx(W,{title:"Purchase history"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[M?e.jsx("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-2 text-sm text-emerald-700",children:M}):null,e.jsxs("div",{className:"rounded-xl border border-sidebar-border/70 bg-background p-6 dark:border-sidebar-border",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Purchase history"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:k>0&&x.from!==null&&x.to!==null?`Showing ${x.from}-${x.to} of ${k}`:"Track completed checkouts and totals."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{className:"rounded-md border border-sidebar-border/70 px-3 py-1 text-xs font-semibold dark:border-sidebar-border",onClick:()=>A("csv"),type:"button",children:"Export Excel (CSV)"}),e.jsx("button",{className:"rounded-md bg-foreground px-3 py-1 text-xs font-semibold text-background",onClick:()=>A("print"),type:"button",children:"Print / PDF"})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("button",{className:`rounded-md border px-3 py-1 text-xs font-semibold ${g==="history"?"border-foreground bg-foreground text-background":"border-sidebar-border/70 text-muted-foreground"}`,onClick:()=>S("history"),type:"button",children:"Purchase history"}),e.jsx("button",{className:`rounded-md border px-3 py-1 text-xs font-semibold ${g==="reviews"?"border-foreground bg-foreground text-background":"border-sidebar-border/70 text-muted-foreground"}`,onClick:()=>S("reviews"),type:"button",children:"Reviews"})]}),e.jsxs("div",{className:"mt-4 grid gap-3 md:grid-cols-3 xl:grid-cols-6",children:[e.jsx("input",{className:"rounded-md border border-sidebar-border/70 bg-background px-3 py-2 text-xs dark:border-sidebar-border",placeholder:"Status",value:s.status,onChange:r=>n(t=>({...t,status:r.target.value}))}),e.jsx("input",{className:"rounded-md border border-sidebar-border/70 bg-background px-3 py-2 text-xs dark:border-sidebar-border",placeholder:"Reference",value:s.reference,onChange:r=>n(t=>({...t,reference:r.target.value}))}),e.jsx("input",{className:"rounded-md border border-sidebar-border/70 bg-background px-3 py-2 text-xs dark:border-sidebar-border",placeholder:"From (YYYY-MM-DD)",value:s.from,type:"date",onChange:r=>n(t=>({...t,from:r.target.value}))}),e.jsx("input",{className:"rounded-md border border-sidebar-border/70 bg-background px-3 py-2 text-xs dark:border-sidebar-border",placeholder:"To (YYYY-MM-DD)",value:s.to,type:"date",onChange:r=>n(t=>({...t,to:r.target.value}))}),e.jsx("input",{className:"rounded-md border border-sidebar-border/70 bg-background px-3 py-2 text-xs dark:border-sidebar-border",placeholder:"Min total",value:s.min_total,onChange:r=>n(t=>({...t,min_total:r.target.value}))}),e.jsx("input",{className:"rounded-md border border-sidebar-border/70 bg-background px-3 py-2 text-xs dark:border-sidebar-border",placeholder:"Max total",value:s.max_total,onChange:r=>n(t=>({...t,max_total:r.target.value}))})]}),g==="history"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("button",{className:"rounded-md border border-sidebar-border/70 px-3 py-1 text-xs dark:border-sidebar-border",onClick:()=>p(r=>Math.max(1,r-1)),disabled:l||i===1,type:"button",children:"Prev"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Page ",i," of ",h]}),e.jsx("button",{className:"rounded-md border border-sidebar-border/70 px-3 py-1 text-xs dark:border-sidebar-border",onClick:()=>p(r=>Math.min(h,r+1)),disabled:l||i===h,type:"button",children:"Next"})]}),N?e.jsx("div",{className:"mt-4 text-sm text-red-600 dark:text-red-400",children:N}):e.jsxs("div",{className:"mt-4 overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-muted/50 text-xs uppercase text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Reference"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3",children:"Purchased"}),e.jsx("th",{className:"px-4 py-3",children:"Items"}),e.jsx("th",{className:"px-4 py-3",children:"Amount"}),e.jsx("th",{className:"px-4 py-3",children:"Cashback"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Details"})]})}),e.jsx("tbody",{children:l?Array.from({length:6}).map((r,t)=>e.jsxs("tr",{className:"border-b border-sidebar-border/70 dark:border-sidebar-border",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 w-32 animate-pulse rounded bg-muted"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 w-16 animate-pulse rounded bg-muted"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 w-24 animate-pulse rounded bg-muted"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 w-10 animate-pulse rounded bg-muted"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 w-20 animate-pulse rounded bg-muted"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 w-20 animate-pulse rounded bg-muted"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"h-4 w-10 animate-pulse rounded bg-muted"})})]},`skeleton-${t}`)):c.map(r=>e.jsxs(d.Fragment,{children:[e.jsxs("tr",{className:"border-b border-sidebar-border/70 dark:border-sidebar-border",children:[e.jsx("td",{className:"px-4 py-3 text-xs font-medium",children:r.payment_reference}),e.jsx("td",{className:"px-4 py-3 text-xs uppercase text-muted-foreground",children:r.status}),e.jsx("td",{className:"px-4 py-3 text-xs",children:r.purchased_at?new Date(r.purchased_at).toLocaleDateString():"—"}),e.jsx("td",{className:"px-4 py-3 text-xs",children:r.items_count}),e.jsx("td",{className:"px-4 py-3 text-xs font-semibold",children:o(r.amount_due)}),e.jsx("td",{className:"px-4 py-3 text-xs text-emerald-600 dark:text-emerald-300",children:o(r.cashback_total)}),e.jsx("td",{className:"px-4 py-3 text-right text-xs",children:e.jsx("button",{className:"rounded-md border border-sidebar-border/70 px-2 py-1 text-xs font-semibold dark:border-sidebar-border",onClick:()=>V(r.id),type:"button",children:w.has(r.id)?"Hide":"View"})})]}),w.has(r.id)?e.jsx("tr",{className:"border-b border-sidebar-border/70 dark:border-sidebar-border",children:e.jsx("td",{className:"px-4 pb-4 text-xs text-muted-foreground",colSpan:7,children:e.jsxs("div",{className:"rounded-lg border border-sidebar-border/60 bg-muted/40 p-3 dark:border-sidebar-border",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Items breakdown"}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Subtotal: ",o(r.subtotal)]}),e.jsxs("span",{children:["Discount: ",o(r.discount_total)]}),e.jsxs("span",{children:["Cashback: ",o(r.cashback_total)]}),e.jsxs("span",{className:"font-semibold text-foreground",children:["Total: ",o(r.amount_due)]})]})]}),e.jsx("div",{className:"mt-3 grid gap-2",children:r.items?.length?r.items.map(t=>e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-foreground",children:t.name})," ","x",t.quantity,e.jsxs("span",{className:"ml-2 text-muted-foreground",children:[o(t.unit_price)," each"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Discount: ",o(t.discount_amount)]}),e.jsxs("span",{className:"text-muted-foreground",children:["Cashback: ",o(t.cashback_amount)]}),e.jsx("span",{className:"font-semibold text-foreground",children:o(t.line_total)})]})]},t.id)):e.jsx("span",{children:"No items recorded."})})]})})}):null]},r.id))})]}),!l&&c.length===0?e.jsx("div",{className:"rounded-lg border border-dashed border-sidebar-border/60 p-6 text-sm text-muted-foreground dark:border-sidebar-border",children:"No purchases found for the selected filters."}):null]})]}):e.jsx("div",{className:"mt-4 space-y-3",children:l?Array.from({length:3}).map((r,t)=>e.jsxs("div",{className:"rounded-lg border border-sidebar-border/70 p-4 dark:border-sidebar-border",children:[e.jsx("div",{className:"h-4 w-1/2 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"mt-2 h-4 w-1/3 animate-pulse rounded bg-muted"})]},`review-skeleton-${t}`)):F.length?F.map(r=>e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-lg border border-sidebar-border/70 p-4 dark:border-sidebar-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:r.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Purchased ",r.quantity,"x"]})]}),e.jsx("button",{className:"rounded-md border border-sidebar-border/70 px-3 py-2 text-xs font-semibold dark:border-sidebar-border",onClick:()=>O(r.productId,r.name),type:"button",children:"Leave a review"})]},r.productId)):e.jsx("div",{className:"rounded-lg border border-dashed border-sidebar-border/60 p-6 text-sm text-muted-foreground dark:border-sidebar-border",children:"No purchased items available for review."})})]})]}),e.jsx(G,{open:!!m,onOpenChange:r=>r?null:b(null),children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Rate product"}),e.jsx(X,{children:"Share your experience to help other shoppers."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:m?.name??"Product"}),e.jsx("div",{className:"mt-2 flex items-center gap-2",children:[1,2,3,4,5].map(r=>e.jsx("button",{className:`rounded-md border px-2 py-1 text-sm ${r<=C?"border-amber-300 bg-amber-50 text-amber-700":"border-sidebar-border/70 text-muted-foreground"}`,onClick:()=>P(r),type:"button",children:"★"},r))})]}),e.jsx("textarea",{className:"min-h-[120px] w-full rounded-md border border-sidebar-border/70 bg-background px-3 py-2 text-sm dark:border-sidebar-border",placeholder:"Write your review...",value:f,onChange:r=>D(r.target.value)}),_?e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:_}):null]}),e.jsxs(Z,{children:[e.jsx("button",{className:"rounded-md border border-sidebar-border/70 px-3 py-2 text-sm dark:border-sidebar-border",onClick:()=>b(null),type:"button",children:"Cancel"}),e.jsx("button",{className:"rounded-md bg-foreground px-3 py-2 text-sm font-semibold text-background transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-50",onClick:B,disabled:R||f.trim().length===0,type:"button",children:R?"Submitting...":"Submit review"})]})]})})]})}export{ce as default};
